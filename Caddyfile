:8080 {
	# Logging
	log {
		output stdout
		format console
		level INFO
	}

	# Health check endpoint
	respond /health 200

	# Reverse proxy for API calls to operator service
	handle_path /api/* {
		reverse_proxy krkn-operator-controller-manager-api-service:8080 {
			# Long timeouts for streaming endpoints
			transport http {
				read_timeout 0
				write_timeout 0
				dial_timeout 30s
			}

			# Enable immediate flushing for streaming (0 = immediate)
			flush_interval 0

			# Headers for streaming
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}

			# Health check
			health_uri /health
			health_interval 10s
			health_timeout 5s
		}
	}

	# Serve React static files
	handle /* {
		root * /usr/share/caddy
		try_files {path} /index.html
		file_server
		encode gzip
	}

	# Error handling
	handle_errors {
		respond "{err.status_code} {err.status_text}"
	}
}
